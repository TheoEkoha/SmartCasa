import {
  sendBatchTransaction
} from "./chunk-CZ7WVFX7.js";
import {
  sendAndConfirmTransaction
} from "./chunk-BLPPDVKS.js";
import {
  eth_getTransactionReceipt
} from "./chunk-3LJDADP5.js";
import "./chunk-AMZH42T2.js";
import "./chunk-USDSUBYK.js";
import "./chunk-RA3DLHVA.js";
import "./chunk-2FH4XCFL.js";
import "./chunk-SLZOTTBF.js";
import "./chunk-HH2NFLAA.js";
import "./chunk-2DJSHGKD.js";
import "./chunk-K7UUQ4WM.js";
import "./chunk-3W3VZZMV.js";
import "./chunk-NGTTZXO4.js";
import "./chunk-EAOC3Z6M.js";
import "./chunk-PZWOPBWI.js";
import "./chunk-LIZCRVOE.js";
import "./chunk-HAADYJEF.js";
import "./chunk-7YU2D6DQ.js";
import "./chunk-CA5U54LE.js";
import "./chunk-UV67MG5D.js";
import "./chunk-6JYFO65Y.js";
import "./chunk-CY3CMUVN.js";
import "./chunk-4WCZ4M4G.js";
import {
  uint8ArrayToHex
} from "./chunk-BNK74YTA.js";
import "./chunk-GDDTQ4UI.js";
import {
  getRpcClient
} from "./chunk-DX3L4J3I.js";
import "./chunk-7IZG4EP5.js";
import "./chunk-RTMCFHYL.js";
import "./chunk-MHFR2GDE.js";
import "./chunk-23BT2CJB.js";
import "./chunk-EZ4JTQAA.js";
import "./chunk-SHWHM7JY.js";
import "./chunk-6DS3JJEL.js";
import "./chunk-5T22KE46.js";
import "./chunk-Z2F5LG57.js";
import "./chunk-EWAXOTDC.js";
import "./chunk-TEQAYQEZ.js";
import "./chunk-JE6AHIQZ.js";

// node_modules/thirdweb/dist/esm/utils/random.js
function randomBytesHex(length = 32) {
  return uint8ArrayToHex(randomBytesBuffer(length));
}
function randomBytesBuffer(length = 32) {
  return globalThis.crypto.getRandomValues(new Uint8Array(length));
}

// node_modules/thirdweb/dist/esm/wallets/in-app/core/eip5972/in-app-wallet-calls.js
var bundlesToTransactions = /* @__PURE__ */ new Map();
var MAX_BUNDLE_ENTRIES = 1e3;
function setBundleId(bundleId, hashes) {
  if (bundlesToTransactions.size >= MAX_BUNDLE_ENTRIES) {
    const lru = bundlesToTransactions.keys().next().value;
    bundlesToTransactions.delete(lru);
  }
  bundlesToTransactions.set(bundleId, hashes);
}
async function inAppWalletSendCalls(args) {
  const { account, calls } = args;
  const hashes = [];
  const bundleId = randomBytesHex(65);
  bundlesToTransactions.set(bundleId, hashes);
  if (account.sendBatchTransaction) {
    const receipt = await sendBatchTransaction({
      account,
      transactions: calls
    });
    hashes.push(receipt.transactionHash);
    setBundleId(bundleId, hashes);
  } else {
    for (const tx of calls) {
      const receipt = await sendAndConfirmTransaction({
        account,
        transaction: tx
      });
      hashes.push(receipt.transactionHash);
      bundlesToTransactions.set(bundleId, hashes);
    }
  }
  return bundleId;
}
async function inAppWalletGetCallsStatus(args) {
  const { wallet, client, bundleId } = args;
  const chain = wallet.getChain();
  if (!chain) {
    throw new Error("Failed to get calls status, no active chain found");
  }
  const bundle = bundlesToTransactions.get(bundleId);
  if (!bundle) {
    throw new Error("Failed to get calls status, unknown bundle id");
  }
  const request = getRpcClient({ client, chain });
  let status = "CONFIRMED";
  const receipts = await Promise.all(bundle.map((hash) => eth_getTransactionReceipt(request, { hash }).then((receipt) => ({
    logs: receipt.logs.map((l) => ({
      address: l.address,
      data: l.data,
      topics: l.topics
    })),
    status: receipt.status,
    blockHash: receipt.blockHash,
    blockNumber: receipt.blockNumber,
    gasUsed: receipt.gasUsed,
    transactionHash: receipt.transactionHash
  })).catch(() => {
    status = "PENDING";
    return null;
  })));
  return {
    status,
    receipts: receipts.filter((r) => r !== null)
    // ts 5.5 please come we need you
  };
}
export {
  inAppWalletGetCallsStatus,
  inAppWalletSendCalls
};
//# sourceMappingURL=in-app-wallet-calls-VCMUYJVD.js.map
