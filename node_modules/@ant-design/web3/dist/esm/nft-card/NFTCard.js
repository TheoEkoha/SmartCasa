import { useUniqueInlineId } from '@inline-svg-unique-id/react';
import React, { useState } from 'react';
import Icon from '@ant-design/icons';
import { getWeb3AssetUrl, parseNumberToBigint } from '@ant-design/web3-common';
import { Button, ConfigProvider, Divider, Image, Result, Skeleton, Space, theme } from 'antd';
import classNames from 'classnames';
import { CryptoPrice } from "../crypto-price";
import useIntl from "../hooks/useIntl";
import useNFT from "../hooks/useNFT";
import { formatNumUnit, isDarkTheme } from "../utils/tool";
var HeartFilledSvg = function HeartFilledSvg(props) {
  const _id3 = useUniqueInlineId();
  const _id2 = useUniqueInlineId();
  const _id = useUniqueInlineId();
  return /*#__PURE__*/_jsxs("svg", {
    ...props,
    children: [/*#__PURE__*/_jsxs("defs", {
      children: [/*#__PURE__*/_jsxs("linearGradient", {
        x1: "50%",
        y1: "0%",
        x2: "50%",
        y2: "100%",
        id: _id,
        children: [/*#__PURE__*/_jsx("stop", {
          stopColor: "#FF8B8B",
          offset: "0%"
        }), /*#__PURE__*/_jsx("stop", {
          stopColor: "#FF1717",
          offset: "100%"
        })]
      }), /*#__PURE__*/_jsxs("filter", {
        x: "-10%",
        y: "-11.1%",
        width: "120%",
        height: "122.2%",
        filterUnits: "objectBoundingBox",
        id: _id2,
        children: [/*#__PURE__*/_jsx("feGaussianBlur", {
          stdDeviation: "1.5",
          in: "SourceAlpha",
          result: "shadowBlurInner1"
        }), /*#__PURE__*/_jsx("feOffset", {
          dx: "1",
          dy: "1",
          in: "shadowBlurInner1",
          result: "shadowOffsetInner1"
        }), /*#__PURE__*/_jsx("feComposite", {
          in: "shadowOffsetInner1",
          in2: "SourceAlpha",
          operator: "arithmetic",
          k2: "-1",
          k3: "1",
          result: "shadowInnerInner1"
        }), /*#__PURE__*/_jsx("feColorMatrix", {
          values: "0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.746667395 0",
          in: "shadowInnerInner1"
        })]
      }), /*#__PURE__*/_jsx("path", {
        d: "M36.516 21.689a6.05 6.05 0 0 0-1.317-1.926 6.12 6.12 0 0 0-1.945-1.29 6.118 6.118 0 0 0-2.37-.473A6.162 6.162 0 0 0 27 19.375 6.162 6.162 0 0 0 23.12 18c-.822 0-1.618.158-2.37.472a6.106 6.106 0 0 0-3.263 3.217 5.988 5.988 0 0 0-.486 2.37c0 .774.157 1.581.47 2.402.262.686.637 1.398 1.116 2.117.76 1.137 1.803 2.323 3.1 3.526a34.67 34.67 0 0 0 4.366 3.426l.549.353a.74.74 0 0 0 .798 0l.549-.353a35.117 35.117 0 0 0 4.366-3.426c1.297-1.203 2.34-2.389 3.1-3.526.48-.719.857-1.43 1.116-2.117.313-.82.47-1.628.47-2.402a5.946 5.946 0 0 0-.484-2.37Z",
        id: _id3
      })]
    }), /*#__PURE__*/_jsxs("g", {
      transform: "translate(-17 -18)",
      fillRule: "nonzero",
      fill: "none",
      children: [/*#__PURE__*/_jsx("use", {
        fill: `url(#${_id})`,
        xlinkHref: `#${_id3}`
      }), /*#__PURE__*/_jsx("use", {
        fill: "#000",
        filter: `url(#${_id2})`,
        xlinkHref: `#${_id3}`
      })]
    })]
  });
};
HeartFilledSvg.defaultProps = {
  viewBox: "0 0 20 18",
  xmlns: "http://www.w3.org/2000/svg",
  xmlnsXlink: "http://www.w3.org/1999/xlink"
};
var HeartSvg = function HeartSvg(props) {
  return /*#__PURE__*/_jsx("svg", {
    ...props,
    children: /*#__PURE__*/_jsx("path", {
      d: "M21.633 6.647a6.095 6.095 0 0 0-1.334-1.94A6.219 6.219 0 0 0 15.93 2.93 6.26 6.26 0 0 0 12 4.315 6.26 6.26 0 0 0 8.07 2.93 6.219 6.219 0 0 0 3.7 4.706a6.057 6.057 0 0 0-1.825 4.33c0 .78.16 1.593.476 2.42.265.692.644 1.409 1.13 2.133.768 1.146 1.825 2.341 3.138 3.553a35.08 35.08 0 0 0 4.42 3.453l.556.356a.753.753 0 0 0 .808 0l.556-.356a35.534 35.534 0 0 0 4.42-3.453c1.312-1.212 2.37-2.407 3.138-3.553a10.72 10.72 0 0 0 1.13-2.133c.316-.827.476-1.64.476-2.42a5.968 5.968 0 0 0-.49-2.39ZM12 19.097S3.656 13.75 3.656 9.035c0-2.388 1.976-4.324 4.414-4.324 1.713 0 3.199.956 3.93 2.353a4.426 4.426 0 0 1 3.93-2.353c2.438 0 4.414 1.936 4.414 4.324 0 4.716-8.344 10.062-8.344 10.062Z",
      fill: "#000",
      fillRule: "nonzero",
      fillOpacity: ".723",
      opacity: ".85"
    })
  });
};
HeartSvg.defaultProps = {
  viewBox: "0 0 24 24",
  xmlns: "http://www.w3.org/2000/svg"
};
import { useStyle } from "./style";
import { jsx as _jsx } from "react/jsx-runtime";
import { jsxs as _jsxs } from "react/jsx-runtime";
import { Fragment as _Fragment } from "react/jsx-runtime";
const customizePrefixCls = 'ant-web3-nft-card';
const {
  useToken
} = theme;
const CardSkeleton = ({
  children,
  loading,
  prefixCls
}) => {
  if (loading) {
    return /*#__PURE__*/_jsxs(Space, {
      direction: "vertical",
      className: classNames(`${prefixCls}-wrap`),
      children: [/*#__PURE__*/_jsx(Skeleton.Image, {
        active: true,
        className: `${prefixCls}-content`
      }), /*#__PURE__*/_jsx(Skeleton, {
        active: true,
        className: `${prefixCls}-body`
      }), /*#__PURE__*/_jsx(Skeleton.Button, {
        block: true,
        active: true,
        className: `${prefixCls}-button`
      }), /*#__PURE__*/_jsx(Divider, {
        dashed: true,
        style: {
          marginBlock: 0
        }
      }), /*#__PURE__*/_jsx(Skeleton.Input, {
        active: true,
        className: `${prefixCls}-footer`
      })]
    });
  }
  return /*#__PURE__*/_jsx(_Fragment, {
    children: children
  });
};
const NFTCard = props => {
  const {
    style,
    antdImageProps,
    className,
    type = 'default',
    address,
    tokenId,
    price,
    like: likeConfig,
    showAction,
    actionText,
    footer,
    onActionClick,
    getNFTMetadata,
    locale,
    errorRender,
    ...metadataProps
  } = props;
  const {
    liked = false,
    totalLikes = 0,
    onLikeChange
  } = likeConfig || {};
  const {
    token
  } = useToken();
  const {
    metadata,
    loading,
    error
  } = useNFT(address, parseNumberToBigint(tokenId), getNFTMetadata);
  const {
    name = metadata?.name,
    image = metadata?.image,
    description = metadata?.description
  } = metadataProps;
  const {
    messages
  } = useIntl('NFTCard', locale);
  const {
    getPrefixCls
  } = React.useContext(ConfigProvider.ConfigContext);
  const prefixCls = getPrefixCls('nft-card', customizePrefixCls);
  //================== Style ==================
  const {
    wrapSSR,
    hashId
  } = useStyle(prefixCls);
  const mergeCls = classNames(`${prefixCls}-container`, {
    [`${prefixCls}-pithy`]: type === 'pithy',
    [`${prefixCls}-theme-dark`]: isDarkTheme(token)
  }, className, hashId);
  const [like, setLike] = useState(liked);
  const handleLikeChange = () => {
    const likeValue = !like;
    setLike(likeValue);
    onLikeChange?.(likeValue);
  };
  const iconLikeGroup = /*#__PURE__*/_jsxs("div", {
    className: `${prefixCls}-like-icon-group`,
    style: {
      position: 'absolute',
      top: 5,
      right: -2
    },
    children: [/*#__PURE__*/_jsx(Icon, {
      component: HeartFilledSvg
    }), /*#__PURE__*/_jsx(Icon, {
      component: HeartFilledSvg,
      style: {
        transform: 'scale(0.4)',
        position: 'absolute',
        right: -8,
        top: -12
      }
    }), /*#__PURE__*/_jsx(Icon, {
      component: HeartFilledSvg,
      style: {
        transform: 'scale(0.3)',
        position: 'absolute',
        right: 10,
        top: -16
      }
    })]
  });
  const content = /*#__PURE__*/_jsxs(_Fragment, {
    children: [/*#__PURE__*/_jsxs("div", {
      className: `${prefixCls}-content`,
      children: [type !== 'pithy' && tokenId !== undefined && /*#__PURE__*/_jsx("div", {
        className: `${prefixCls}-serial-number`,
        children: `#${tokenId}`
      }), typeof image === 'string' ? /*#__PURE__*/_jsx(Image, {
        width: "100%",
        style: {
          imageRendering: 'pixelated'
        },
        src: getWeb3AssetUrl(image),
        ...antdImageProps,
        fallback: "data:image/png;base64,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"
      }) : image]
    }), /*#__PURE__*/_jsxs("div", {
      className: `${prefixCls}-body`,
      children: [tokenId !== undefined && type === 'pithy' && /*#__PURE__*/_jsxs("div", {
        className: `${prefixCls}-serial-number`,
        children: ["No:", tokenId.toString()]
      }), name && /*#__PURE__*/_jsx("div", {
        className: `${prefixCls}-name`,
        children: name
      }), description && /*#__PURE__*/_jsx("div", {
        className: `${prefixCls}-description`,
        children: description
      }), /*#__PURE__*/_jsxs("div", {
        className: `${prefixCls}-info`,
        children: [price && /*#__PURE__*/_jsx("div", {
          className: `${prefixCls}-price`,
          children: /*#__PURE__*/_jsx(CryptoPrice, {
            ...price
          })
        }), likeConfig && /*#__PURE__*/_jsxs("div", {
          className: `${prefixCls}-likes`,
          children: [/*#__PURE__*/_jsxs("div", {
            className: classNames(`${prefixCls}-like-icon`, {
              [`${prefixCls}-like-icon-liked`]: like
            }),
            onClick: handleLikeChange,
            children: [iconLikeGroup, !like && /*#__PURE__*/_jsx(Icon, {
              component: HeartSvg,
              className: `${prefixCls}-like-icon-icon-heart`
            })]
          }), /*#__PURE__*/_jsx("span", {
            className: `${prefixCls}-like-value`,
            children: formatNumUnit(totalLikes)
          })]
        })]
      }), showAction && /*#__PURE__*/_jsx("div", {
        className: `${prefixCls}-action`,
        children: /*#__PURE__*/_jsx(Button, {
          onClick: onActionClick,
          children: actionText ?? messages.actionText
        })
      }), footer && /*#__PURE__*/_jsxs("div", {
        className: `${prefixCls}-footer`,
        children: [/*#__PURE__*/_jsx(Divider, {
          dashed: true
        }), footer]
      })]
    })]
  });
  const renderContent = () => {
    if (error) {
      return errorRender?.(error) || /*#__PURE__*/_jsx(Result, {
        status: "warning",
        subTitle: error.message
      });
    }
    return content;
  };
  return wrapSSR( /*#__PURE__*/_jsx("div", {
    className: mergeCls,
    style: style,
    children: /*#__PURE__*/_jsx("div", {
      className: `${prefixCls}-inner`,
      children: /*#__PURE__*/_jsx(CardSkeleton, {
        prefixCls: `${prefixCls}-skeleton`,
        loading: loading,
        children: renderContent()
      })
    })
  }));
};
export default NFTCard;