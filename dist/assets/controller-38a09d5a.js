import{B as L,ab as J,ac as j,a3 as C,a7 as R,ad as $,ae as z,a0 as B,af as K,ag as E,a8 as Y,y as I,a9 as G,ah as A,ai as X,$ as x,aj as k,Q as Z,u as O,a1 as ee,n as ae,v as ne,aa as te}from"./index-271e5b0c.js";const ie=e=>e;class se extends L{constructor({body:n,error:t,url:c}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${ie(c)}`,`Request body: ${J(n)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code}}const ce=-1;class re extends L{constructor(n,{code:t,docsPath:c,metaMessages:i,name:a,shortMessage:s}){super(s,{cause:n,docsPath:c,metaMessages:i||(n==null?void 0:n.metaMessages),name:a||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=a||n.name,this.code=n instanceof se?n.code:t??ce}}class H extends re{constructor(n,t){super(n,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class q extends H{constructor(n){super(n,{code:q.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(q,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class P extends H{constructor(n){super(n,{code:P.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const N="wallet_addEthereumChain",oe=!0,M={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};function me(e){return e.id==="walletConnect"}async function Ce(e,n,t,c,i){var g,y;const a=await F(e,t,i),s=e.walletConnect;let{onDisplayUri:d}=s||{};if(!d&&i&&t!=="walletConnect"){const m=await j(t);d=b=>{const T=m.mobile.native||m.mobile.universal;if(!T)throw new Error("No app url found for wallet connect to redirect to.");const v=X(T,b).redirect;i(v)}}d&&a.events.addListener("display_uri",d);let l=s==null?void 0:s.optionalChains,r=e.chain;t==="global.safe"&&(l=V.map(C),r&&!l.includes(r)&&(r=void 0));const{rpcMap:o,chainsToRequest:u}=Q({client:e.client,chain:r,optionalChains:l});a.session&&await a.connect({...s!=null&&s.pairingTopic?{pairingTopic:s==null?void 0:s.pairingTopic}:{},optionalChains:u,chains:r?[r.id]:u.length>0?[u[0]]:[1],rpcMap:o}),U(u,c);const h=(await a.enable())[0];if(!h)throw new Error("No accounts found on provider.");const p=R(a.chainId),w=e.chain&&e.chain.id===p?e.chain:C(p);if(e){const m={optionalChains:(g=e.walletConnect)==null?void 0:g.optionalChains,chain:e.chain,pairingTopic:(y=e.walletConnect)==null?void 0:y.pairingTopic};c&&$(c,t,m)}return s!=null&&s.onDisplayUri&&a.events.removeListener("display_uri",s.onDisplayUri),W(h,w,a,n,c)}async function pe(e,n,t,c,i){const a=c?await z(c,t):null,s=await F(a?{chain:a.chain,client:e.client,walletConnect:{pairingTopic:a.pairingTopic,optionalChains:a.optionalChains}}:{client:e.client,walletConnect:{}},t,i,!0),d=s.accounts[0];if(!d)throw new Error("No accounts found on provider.");const l=R(s.chainId),r=e.chain&&e.chain.id===l?e.chain:C(l);return W(d,r,s,n,c)}async function F(e,n,t,c=!1){var p,w,g,y;const i=await j(n),a=e.walletConnect,{EthereumProvider:s,OPTIONAL_EVENTS:d,OPTIONAL_METHODS:l}=await B(()=>import("./index.es-8f613a3e.js"),["assets/index.es-8f613a3e.js","assets/index-271e5b0c.js","assets/index-096ed763.css"]);let r=a==null?void 0:a.optionalChains,o=e.chain;n==="global.safe"&&(r=V.map(C),o&&!r.includes(o)&&(o=void 0));const{rpcMap:u,chainsToRequest:f}=Q({client:e.client,chain:o,optionalChains:r}),h=await s.init({showQrModal:(a==null?void 0:a.showQrModal)===void 0?t?!1:oe:a.showQrModal,projectId:(a==null?void 0:a.projectId)||K,optionalMethods:l,optionalEvents:d,optionalChains:f,chains:o?[o.id]:f.length>0?[f[0]]:[1],metadata:{name:((p=a==null?void 0:a.appMetadata)==null?void 0:p.name)||E().name,description:((w=a==null?void 0:a.appMetadata)==null?void 0:w.description)||E().description,url:((g=a==null?void 0:a.appMetadata)==null?void 0:g.url)||E().url,icons:[((y=a==null?void 0:a.appMetadata)==null?void 0:y.logoUrl)||E().logoUrl]},rpcMap:u,qrModalOptions:a==null?void 0:a.qrModalOptions,disableProviderPing:!0});if(h.events.setMaxListeners(Number.POSITIVE_INFINITY),c||h.session&&await h.disconnect(),n!=="walletConnect"){let m=function(){var b,T,v,D;const _=((D=(v=(T=(b=h.session)==null?void 0:b.peer)==null?void 0:T.metadata)==null?void 0:v.redirect)==null?void 0:D.native)||i.mobile.native||i.mobile.universal;t&&_&&t(_)};h.signer.client.on("session_request_sent",m),h.events.addListener("disconnect",()=>{h.signer.client.off("session_request_sent",m)})}return h}function S(e,n){return{address:x(n),async sendTransaction(i){return{transactionHash:await e.request({method:"eth_sendTransaction",params:[{gas:i.gas?I(i.gas):void 0,value:i.value?I(i.value):void 0,from:this.address,to:i.to,data:i.data}]})}},async signMessage({message:i}){const a=(()=>typeof i=="string"?Z(i):i.raw instanceof Uint8Array?O(i.raw):i.raw)();return e.request({method:"personal_sign",params:[a,this.address]})},async signTypedData(i){const a=ee(i),{domain:s,message:d,primaryType:l}=a,r={EIP712Domain:ae({domain:s}),...a.types};ne({domain:s,message:d,primaryType:l,types:r});const o=te({domain:s??{},message:d,primaryType:l,types:r});return await e.request({method:"eth_signTypedData_v4",params:[this.address,o]})}}}function W(e,n,t,c,i){const a=S(t,e);async function s(){t.removeListener("accountsChanged",l),t.removeListener("chainChanged",r),t.removeListener("disconnect",d),await t.disconnect()}function d(){U([],i),i==null||i.removeItem(M.lastUsedChainId),s(),c.emit("disconnect",void 0)}function l(o){if(o[0]){const u=S(t,x(o[0]));c.emit("accountChanged",u),c.emit("accountsChanged",o)}else d()}function r(o){const u=C(R(o));c.emit("chainChanged",u),i==null||i.setItem(M.lastUsedChainId,String(o))}return t.on("accountsChanged",l),t.on("chainChanged",r),t.on("disconnect",d),t.on("session_delete",d),[a,n,s,o=>ue(t,o,i)]}function de(e){var n,t;return((t=(n=e.session)==null?void 0:n.namespaces[k])==null?void 0:t.methods)||[]}function le(e){var t,c,i;return((i=(c=(t=e.session)==null?void 0:t.namespaces[k])==null?void 0:c.chains)==null?void 0:i.map(a=>Number.parseInt(a.split(":")[1]||"")))??[]}async function ue(e,n,t){var i,a;const c=n.id;try{const s=le(e),d=de(e);if(!s.includes(c)&&d.includes(N)){const r=await Y(n),o=[...new Set([...((i=n.blockExplorers)==null?void 0:i.map(f=>f.url))||[],...((a=r.explorers)==null?void 0:a.map(f=>f.url))||[]])];await e.request({method:N,params:[{chainId:I(r.chainId),chainName:r.name,nativeCurrency:r.nativeCurrency,rpcUrls:G(r),blockExplorerUrls:o.length>0?o:void 0}]});const u=await he(t);u.push(c),U(u,t)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:I(c)}]})}catch(s){const d=typeof s=="string"?s:s==null?void 0:s.message;throw/user rejected request/i.test(d)?new q(s):new P(s)}}function U(e,n){n==null||n.setItem(M.requestedChains,JSON.stringify(e))}async function he(e){const n=await e.getItem(M.requestedChains);return n?JSON.parse(n):[]}function Q(e){const n={};e.chain&&(n[e.chain.id]=A({chain:e.chain,client:e.client}));const t=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const a of t)n[a.id]=A({chain:a,client:e.client});const c=t.map(a=>a.id)||[],i=e.chain?[e.chain.id,...c]:c.length>0?c:[1];return!e.chain&&t.length===0&&(n[1]=C(1).rpc),{rpcMap:n,chainsToRequest:i}}const V=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{pe as autoConnectWC,Ce as connectWC,me as isWalletConnect};
