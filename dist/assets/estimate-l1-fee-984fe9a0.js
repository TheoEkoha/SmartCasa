import{B as u,cr as I,cq as P,da as W,i as X,d as Z,p as i,s as O,cp as J,b as w,I as z,dY as Q,dZ as ee,d_ as F,d$ as E,X as te,z as ne,r as se}from"./index-271e5b0c.js";import{t as y}from"./toRlp-6af83ae6.js";const oe={ether:-9,wei:9};function re(e,t){let n=e.toString();const s=n.startsWith("-");s&&(n=n.slice(1)),n=n.padStart(t,"0");let[o,r]=[n.slice(0,n.length-t),n.slice(n.length-t)];return r=r.replace(/(0+)$/,""),`${s?"-":""}${o||"0"}${r?`.${r}`:""}`}function B(e,t="wei"){return re(e,oe[t])}function ie(e){const t=Object.entries(e).map(([s,o])=>o===void 0||o===!1?null:[s,o]).filter(Boolean),n=t.reduce((s,[o])=>Math.max(s,o.length),0);return t.map(([s,o])=>`  ${`${s}:`.padEnd(n+1)}  ${o}`).join(`
`)}class ae extends u{constructor({v:t}){super(`Invalid \`v\` value "${t}". Expected 27 or 28.`,{name:"InvalidLegacyVError"})}}class ce extends u{constructor({transaction:t}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",ie(t),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}}class de extends u{constructor({storageKey:t}){super(`Size for storage key "${t}" is invalid. Expected 32 bytes. Got ${Math.floor((t.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}}class G extends u{constructor({cause:t,maxFeePerGas:n}={}){super(`The fee cap (\`maxFeePerGas\`${n?` = ${B(n)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:t,name:"FeeCapTooHighError"})}}Object.defineProperty(G,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class _ extends u{constructor({cause:t,maxPriorityFeePerGas:n,maxFeePerGas:s}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${n?` = ${B(n)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${s?` = ${B(s)} gwei`:""}).`].join(`
`),{cause:t,name:"TipAboveFeeCapError"})}}Object.defineProperty(_,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});function U(e){const{kzg:t}=e,n=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),s=typeof e.blobs[0]=="string"?e.blobs.map(r=>I(r)):e.blobs,o=[];for(const r of s)o.push(Uint8Array.from(t.blobToKzgCommitment(r)));return n==="bytes"?o:o.map(r=>P(r))}function R(e){const{kzg:t}=e,n=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),s=typeof e.blobs[0]=="string"?e.blobs.map(a=>I(a)):e.blobs,o=typeof e.commitments[0]=="string"?e.commitments.map(a=>I(a)):e.commitments,r=[];for(let a=0;a<s.length;a++){const c=s[a],d=o[a];r.push(Uint8Array.from(t.computeBlobKzgProof(c,d)))}return n==="bytes"?r:r.map(a=>P(a))}function fe(e,t){const n=t||"hex",s=W(X(e,{strict:!1})?Z(e):e);return n==="bytes"?s:i(s)}function le(e){const{commitment:t,version:n=1}=e,s=e.to??(typeof t=="string"?"hex":"bytes"),o=fe(t,"bytes");return o.set([n],0),s==="bytes"?o:P(o)}function ue(e){const{commitments:t,version:n}=e,s=e.to??(typeof t[0]=="string"?"hex":"bytes"),o=[];for(const r of t)o.push(le({commitment:r,to:s,version:n}));return o}const j=6,D=32,A=4096,Y=D*A,K=Y*j-1-1*A*j,q=1;class he extends u{constructor({maxSize:t,size:n}){super("Blob size is too large.",{metaMessages:[`Max: ${t} bytes`,`Given: ${n} bytes`],name:"BlobSizeTooLargeError"})}}class N extends u{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}class be extends u{constructor({hash:t,size:n}){super(`Versioned hash "${t}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${n}`],name:"InvalidVersionedHashSizeError"})}}class me extends u{constructor({hash:t,version:n}){super(`Versioned hash "${t}" version is invalid.`,{metaMessages:[`Expected: ${q}`,`Received: ${n}`],name:"InvalidVersionedHashVersionError"})}}function xe(e){const t=e.to??(typeof e.data=="string"?"hex":"bytes"),n=typeof e.data=="string"?I(e.data):e.data,s=O(n);if(!s)throw new N;if(s>K)throw new he({maxSize:K,size:s});const o=[];let r=!0,a=0;for(;r;){const c=J(new Uint8Array(Y));let d=0;for(;d<A;){const f=n.slice(a,a+(D-1));if(c.pushByte(0),c.pushBytes(f),f.length<31){c.pushByte(128),r=!1;break}d++,a+=31}o.push(c)}return t==="bytes"?o.map(c=>c.bytes):o.map(c=>P(c.bytes))}function ye(e){const{data:t,kzg:n,to:s}=e,o=e.blobs??xe({data:t,to:s}),r=e.commitments??U({blobs:o,kzg:n,to:s}),a=e.proofs??R({blobs:o,commitments:r,kzg:n,to:s}),c=[];for(let d=0;d<o.length;d++)c.push({blob:o[d],commitment:r[d],proof:a[d]});return c}function pe(e){if(e.type)return e.type;if(typeof e.authorizationList<"u")return"eip7702";if(typeof e.blobs<"u"||typeof e.blobVersionedHashes<"u"||typeof e.maxFeePerBlobGas<"u"||typeof e.sidecars<"u")return"eip4844";if(typeof e.maxFeePerGas<"u"||typeof e.maxPriorityFeePerGas<"u")return"eip1559";if(typeof e.gasPrice<"u")return typeof e.accessList<"u"?"eip2930":"legacy";throw new ce({transaction:e})}class $ extends u{constructor({chainId:t}){super(typeof t=="number"?`Chain ID "${t}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}function ge(e){const{authorizationList:t}=e;if(t)for(const n of t){const{contractAddress:s,chainId:o}=n;if(!w(s))throw new z({address:s});if(o<=0)throw new $({chainId:o})}H(e)}function Pe(e){const{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new N;for(const n of t){const s=O(n),o=Q(ee(n,0,1));if(s!==32)throw new be({hash:n,size:s});if(o!==q)throw new me({hash:n,version:o})}}H(e)}function H(e){const{chainId:t,maxPriorityFeePerGas:n,maxFeePerGas:s,to:o}=e;if(t<=0)throw new $({chainId:t});if(o&&!w(o))throw new z({address:o});if(s&&s>2n**256n-1n)throw new G({maxFeePerGas:s});if(n&&s&&n>s)throw new _({maxFeePerGas:s,maxPriorityFeePerGas:n})}function we(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:o,to:r}=e;if(t<=0)throw new $({chainId:t});if(r&&!w(r))throw new z({address:r});if(n||o)throw new u("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(s&&s>2n**256n-1n)throw new G({maxFeePerGas:s})}function ze(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:o,to:r}=e;if(r&&!w(r))throw new z({address:r});if(typeof t<"u"&&t<=0)throw new $({chainId:t});if(n||o)throw new u("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(s&&s>2n**256n-1n)throw new G({maxFeePerGas:s})}function ve(e){if(!e||e.length===0)return[];const t=[];for(const n of e){const{contractAddress:s,chainId:o,nonce:r,...a}=n;t.push([i(o),s,[r?i(r):"0x"],...v({},a)])}return t}function L(e){if(!e||e.length===0)return[];const t=[];for(let n=0;n<e.length;n++){const{address:s,storageKeys:o}=e[n];for(let r=0;r<o.length;r++)if(o[r].length-2!==64)throw new de({storageKey:o[r]});if(!w(s,{strict:!1}))throw new z({address:s});t.push([s,o])}return t}function Te(e,t){const n=pe(e);return n==="eip1559"?Fe(e,t):n==="eip2930"?Ge(e,t):n==="eip4844"?Ee(e,t):n==="eip7702"?Ie(e,t):$e(e,t)}function Ie(e,t){const{authorizationList:n,chainId:s,gas:o,nonce:r,to:a,value:c,maxFeePerGas:d,maxPriorityFeePerGas:f,accessList:m,data:b}=e;ge(e);const h=L(m),l=ve(n);return F(["0x04",y([i(s),r?i(r):"0x",f?i(f):"0x",d?i(d):"0x",o?i(o):"0x",a??"0x",c?i(c):"0x",b??"0x",h,l,...v(e,t)])])}function Ee(e,t){const{chainId:n,gas:s,nonce:o,to:r,value:a,maxFeePerBlobGas:c,maxFeePerGas:d,maxPriorityFeePerGas:f,accessList:m,data:b}=e;Pe(e);let h=e.blobVersionedHashes,l=e.sidecars;if(e.blobs&&(typeof h>"u"||typeof l>"u")){const x=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(g=>P(g)),T=e.kzg,p=U({blobs:x,kzg:T});if(typeof h>"u"&&(h=ue({commitments:p})),typeof l>"u"){const g=R({blobs:x,commitments:p,kzg:T});l=ye({blobs:x,commitments:p,proofs:g})}}const S=L(m),V=[i(n),o?i(o):"0x",f?i(f):"0x",d?i(d):"0x",s?i(s):"0x",r??"0x",a?i(a):"0x",b??"0x",S,c?i(c):"0x",h??[],...v(e,t)],C=[],k=[],M=[];if(l)for(let x=0;x<l.length;x++){const{blob:T,commitment:p,proof:g}=l[x];C.push(T),k.push(p),M.push(g)}return F(["0x03",l?y([V,C,k,M]):y(V)])}function Fe(e,t){const{chainId:n,gas:s,nonce:o,to:r,value:a,maxFeePerGas:c,maxPriorityFeePerGas:d,accessList:f,data:m}=e;H(e);const b=L(f),h=[i(n),o?i(o):"0x",d?i(d):"0x",c?i(c):"0x",s?i(s):"0x",r??"0x",a?i(a):"0x",m??"0x",b,...v(e,t)];return F(["0x02",y(h)])}function Ge(e,t){const{chainId:n,gas:s,data:o,nonce:r,to:a,value:c,accessList:d,gasPrice:f}=e;we(e);const m=L(d),b=[i(n),r?i(r):"0x",f?i(f):"0x",s?i(s):"0x",a??"0x",c?i(c):"0x",o??"0x",m,...v(e,t)];return F(["0x01",y(b)])}function $e(e,t){const{chainId:n=0,gas:s,data:o,nonce:r,to:a,value:c,gasPrice:d}=e;ze(e);let f=[r?i(r):"0x",d?i(d):"0x",s?i(s):"0x",a??"0x",c?i(c):"0x",o??"0x"];if(t){const m=(()=>{if(t.v>=35n)return(t.v-35n)/2n>0?t.v:27n+(t.v===35n?0n:1n);if(n>0)return BigInt(n*2)+BigInt(35n+t.v-27n);const l=27n+(t.v===27n?0n:1n);if(t.v!==l)throw new ae({v:t.v});return l})(),b=E(t.r),h=E(t.s);f=[...f,i(m),b==="0x00"?"0x":b,h==="0x00"?"0x":h]}else n>0&&(f=[...f,i(n),"0x","0x"]);return y(f)}function v(e,t){const n=t??e,{v:s,yParity:o}=n;if(typeof n.r>"u")return[];if(typeof n.s>"u")return[];if(typeof s>"u"&&typeof o>"u")return[];const r=E(n.r),a=E(n.s);return[(()=>typeof o=="number"?o?i(1):"0x":s===0n?"0x":s===1n?i(1):s===27n?"0x":i(1))(),r==="0x00"?"0x":r,a==="0x00"?"0x":a]}const Le="0x420000000000000000000000000000000000000F";async function He(e){const{transaction:t,gasPriceOracleAddress:n}=e,s=te({client:t.client,address:n||Le,chain:t.chain}),{gasPrice:o,...r}=await ne({transaction:t}),a=Te({...r,type:"eip1559"});return se({contract:s,method:"function getL1Fee(bytes memory _data) view returns (uint256)",params:[a]})}export{He as estimateL1Fee};
