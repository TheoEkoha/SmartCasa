import{ay as J,w as ee,az as vt,aA as st,a0 as Bt,aB as Et,aC as at,aD as Wt,aE as xe,aF as It,K as it,aG as Ft,$ as $e,aH as j,a5 as t,aI as zt,aJ as d,aK as Rt,aL as Dt,aM as Ot,aN as b,aO as ot,aP as Y,aQ as $,aR as Pt,aS as Mt,aT as Ce,aU as ct,aV as rt,aW as N,X as ye,aX as he,aY as Se,aZ as q,a_ as X,a$ as h,b0 as Te,b1 as E,b2 as Ae,b3 as me,b4 as m,b5 as pe,b6 as K,b7 as ne,b8 as be,b9 as P,ba as ve,bb as Lt,bc as te,bd as V,be as Nt,bf as fe,bg as Be,q as qt,bh as Ge,a8 as _t,bi as Ut,bj as Ht,bk as lt,bl as Qt,bm as dt,bn as $t,bo as Gt,bp as Vt,bq as ut,br as Kt,bs as Yt,bt as je,bu as Zt,bv as Jt,bw as ht,bx as Xt,by as en,bz as Ve,bA as mt,bB as tn,bC as xt,bD as nn,bE as Ke,bF as sn,bG as yt,bH as an,bI as se,bJ as ft,bK as jt,bL as on,bM as cn,a3 as Ye,a2 as rn,bN as ln,bO as dn,bP as Ze,bQ as un,bR as hn,bS as gt,bT as mn,bU as xn,bV as yn,bW as fn,bX as jn,bY as bt,bZ as gn,b_ as bn,b$ as wn,c0 as kn,c1 as Je,c2 as Cn,c3 as Sn,c4 as Tn,c5 as An,c6 as pn,c7 as vn,c8 as Bn}from"./index-271e5b0c.js";import{decimals as En}from"./decimals-dd46fdd8.js";import{getCurrencyMetadata as Wn}from"./getCurrencyMetadata-2f1a33fc.js";import"./decimals-e664db4e.js";const In=J({id:84532,name:"Base Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},blockExplorers:[{name:"Basescan",url:"https://sepolia.basescan.org",apiUrl:"https://api-sepolia.basescan.org/api"}],testnet:!0}),Fn=J({id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorers:[{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}]}),zn=J({id:11155420,name:"OP Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},blockExplorers:[{name:"Blockscout",url:"https://optimism-sepolia.blockscout.com",apiUrl:"https://optimism-sepolia.blockscout.com/api"}],testnet:!0}),Rn=J({id:10,name:"OP Mainnet",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorers:[{name:"Optimism Explorer",url:"https://optimistic.etherscan.io",apiUrl:"https://api-optimistic.etherscan.io"}]}),Dn=J({id:999999999,name:"Zora Sepolia",nativeCurrency:{decimals:18,name:"Zora Sepolia",symbol:"ETH"},blockExplorers:[{name:"Zora Sepolia Explorer",url:"https://sepolia.explorer.zora.energy/",apiUrl:"https://sepolia.explorer.zora.energy/api"}],testnet:!0}),On=J({id:7777777,name:"Zora",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"},blockExplorers:[{name:"Explorer",url:"https://explorer.zora.energy",apiUrl:"https://explorer.zora.energy/api"}]}),Pn=[Fn.id,In.id,Rn.id,zn.id,On.id,Dn.id,34443,919,42220,44787,204,5611];function Mn(e){return Pn.includes(e.id)}async function Ln(e){var c;const{transaction:n}=e,s=e.from??((c=e.account)==null?void 0:c.address)??void 0,i=await ee(n.gas)||await vt({transaction:n,from:s}),a=await st({client:n.client,chain:n.chain});let u;if(Mn(n.chain)){const{estimateL1Fee:o}=await Bt(()=>import("./estimate-l1-fee-984fe9a0.js"),["assets/estimate-l1-fee-984fe9a0.js","assets/index-271e5b0c.js","assets/index-096ed763.css","assets/toRlp-6af83ae6.js"]);u=await o({transaction:n})}else u=0n;const r=i*a+u;return{ether:Et(r),wei:r}}async function Xe(e){const n=await at(e);return Wt(n)}function Nn(e,n){return xe({...n,queryKey:["buyWithCryptoQuote",e],queryFn:()=>{if(!e)throw new Error("Swap params are required");return It(e)},enabled:!!e,retry(s,i){if(s>3)return!1;try{const a=i.error;if(a.code==="MINIMUM_PURCHASE_AMOUNT"||a.statusCode===404||a.statusCode>=500)return!1}catch{return!0}return!0}})}async function qn(e){try{const s=await it(e.client)(Ft(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress,fromAmount:e.fromAmount,toAmount:e.toAmount,maxSlippageBPS:e.maxSlippageBPS,isTestMode:e.isTestMode,purchaseData:e.purchaseData,fromAddress:e.fromAddress,toGasAmountWei:e.toGasAmountWei})});if(!s.ok){const i=await s.json();throw i&&"error"in i?i:new Error(`HTTP error! status: ${s.status}`)}return(await s.json()).result}catch(n){throw console.error("Error getting buy with fiat quote",n),n}}function _n(e,n){return xe({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return qn(e)},enabled:!!e,retry(s,i){if(s>3)return!1;try{const a=i.error;if(a.code==="MINIMUM_PURCHASE_AMOUNT"||a.statusCode===404||a.statusCode>=500)return!1}catch{return!0}return!0}})}function wt(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,s=$e(e.toToken.tokenAddress)===$e(e.onRampToken.token.tokenAddress);return!(n&&s)}const kt=j.forwardRef(function(n,s){return t.jsx(Un,{ref:s,children:t.jsx(zt,{children:t.jsxs(d,{p:"lg",children:[t.jsx(Rt,{children:t.jsx(Dt,{type:"button","aria-label":"Close",onClick:n.close,children:t.jsx(Ot,{width:b.md,height:b.md,style:{color:"inherit"}})})}),n.children]})})})}),Un=ot(e=>{const n=Y();return{zIndex:1e4,borderTopLeftRadius:$.xl,borderTopRightRadius:$.xl,background:n.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${Hn} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${n.colors.borderColor}`}}),Hn=Pt`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,Ct=ot(e=>({backgroundColor:Y().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${Mt} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function St(){const[e,n]=j.useState(!1),s=j.useRef(null),i=j.useRef(null),a=j.useCallback(()=>new Promise(r=>{var c;if(s.current){const o={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},l=s.current.animate([{transform:"translateY(100%)",opacity:0}],o);(c=i.current)==null||c.animate([{opacity:0}],o),l.onfinish=()=>r()}else r()}),[]),u=j.useCallback(async r=>{r?n(!0):(await a(),n(!1))},[a]);return j.useLayoutEffect(()=>{if(!e)return;const r=c=>{s.current&&c.target instanceof Node&&!s.current.contains(c.target)&&u(!1)};return requestAnimationFrame(()=>{document.addEventListener("click",r)}),()=>{document.removeEventListener("click",r)}},[e,u]),{drawerRef:s,drawerOverlayRef:i,setIsOpen:u,isOpen:e}}function Qn(e){var C,F,T,f,R,z;const{payUiOptions:n,supportedDestinations:s,client:i,onContinue:a,payerAccount:u}=e,r=Y(),c=Ce(),o=n.metadata,l=n.paymentInfo,{data:y}=ct(l.chain),{data:p}=rt({client:i,address:l.sellerAddress}),w=xe({queryKey:["amount",l],queryFn:async()=>{let W=18;l.token&&!N(l.token)&&(W=await En({contract:ye({address:l.token.address,chain:l.chain,client:i})}));let D;return"amountWei"in l?D=he(l.amountWei,W):D=l.amount,D}}).data;if(!y||w===void 0)return t.jsx(Se,{});const g=l.token?{...l.token,icon:((C=l.token)==null?void 0:C.icon)||((T=(F=s.find(W=>W.chain.id===l.chain.id))==null?void 0:F.tokens.find(W=>{var D;return W.address.toLowerCase()===((D=l.token)==null?void 0:D.address.toLowerCase())}))==null?void 0:T.icon)}:{address:q,name:y.nativeCurrency.name,symbol:y.nativeCurrency.symbol,icon:(f=y.icon)==null?void 0:f.url};return t.jsxs(d,{p:"lg",children:[t.jsx(X,{title:(o==null?void 0:o.name)||"Payment Details"}),t.jsx(h,{y:"lg"}),t.jsxs(d,{children:[o!=null&&o.image?t.jsx(Te,{client:i,src:o==null?void 0:o.image,style:{width:"100%",borderRadius:E.md,backgroundColor:r.colors.tertiaryBg}}):c?t.jsxs(d,{flex:"row",center:"both",style:{padding:E.md,marginBottom:E.md,borderRadius:E.md,backgroundColor:r.colors.tertiaryBg},children:[t.jsx(Ae,{size:b.xl,id:c.id,client:i}),t.jsx("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:r.colors.secondaryIconColor,marginLeft:E.md,marginRight:E.md}}),t.jsx(me,{client:i,size:b.xl,chainIconUrl:(R=y.icon)==null?void 0:R.url})]}):null,t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(m,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(pe,{chain:l.chain,client:e.client,size:"sm",token:g}),t.jsxs(m,{color:"primaryText",size:"md",weight:700,children:[String(K(Number(w),6))," ",g.symbol]})]})})]}),t.jsx(h,{y:"md"}),t.jsx(ne,{}),t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(m,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(me,{chainIconUrl:(z=y.icon)==null?void 0:z.url,size:"xs",client:e.client}),t.jsx(m,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:y.name})]})})]}),t.jsx(h,{y:"sm"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(m,{size:"xs",color:"secondaryText",children:"Seller"})}),t.jsx(d,{expand:!0,children:t.jsx(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(m,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:p||be(l.sellerAddress)})})})]})]}),t.jsx(h,{y:"xl"}),u?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{a(w,l.chain,g)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(ve,{...e.connectOptions,client:i,theme:r,connectButton:{style:{width:"100%"}}})})]})}function Tt(e){const{estimatedSeconds:n,quoteIsLoading:s}=e;return t.jsxs(d,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:$.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[t.jsxs(d,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t.jsx(Lt,{width:b.sm,height:b.sm}),s?t.jsx(te,{height:V.xs,width:"50px",color:"borderColor"}):t.jsx(m,{size:"xs",color:"secondaryText",children:n!==void 0?`~${Nt(n)}`:"--"})]}),t.jsxs(P,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t.jsx(d,{color:"accentText",flex:"row",center:"both",children:t.jsx($n,{size:b.sm})}),t.jsx(m,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const $n=e=>t.jsxs("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function Gn(e){return t.jsxs(d,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:$.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(Vn,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[t.jsx(e.currency.icon,{size:b.md}),t.jsxs(d,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t.jsx(m,{color:"primaryText",children:e.currency.shorthand}),t.jsx(fe,{width:b.sm,height:b.sm})]})]}),t.jsx("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:E.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:E.sm},children:e.isLoading?t.jsx(te,{width:"100px",height:V.lg}):t.jsx(m,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${K(Number(e.value),6)}`:"--"})})]})}const Vn=Be(P)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function Kn(e){const{transaction:n,account:s,supportedDestinations:i}=e,[a,u]=j.useState();return j.useEffect(()=>{Promise.all([ee(n.value),ee(n.erc20Value),ee(n.to),qt(n)]).then(([r,c,o,l])=>{var y;u({value:r==null?void 0:r.toString(),erc20Value:(y=c==null?void 0:c.amountWei)==null?void 0:y.toString(),erc20Currency:c==null?void 0:c.tokenAddress,to:o,data:l})})},[n]),xe({queryKey:["transaction-cost",n.chain.id,s==null?void 0:s.address,a],queryFn:async()=>{var x,w,g;if(!s)throw new Error("No account");const r=await ee(n.erc20Value);if(r){const[C,F,T]=await Promise.all([Ge({address:s.address,chain:n.chain,client:n.client,tokenAddress:r.tokenAddress}),Wn({contract:ye({address:r.tokenAddress,chain:n.chain,client:n.client})}),we(n,s==null?void 0:s.address)]),f=r.amountWei,R=C;return{token:{address:r.tokenAddress,name:F.name,symbol:F.symbol,icon:(w=(x=i.find(W=>W.chain.id===n.chain.id))==null?void 0:x.tokens.find(W=>W.address.toLowerCase()===r.tokenAddress.toLowerCase()))==null?void 0:w.icon},decimals:F.decimals,walletBalance:R,gasCostWei:T,transactionValueWei:f}}const[c,o,l]=await Promise.all([Ge({address:s.address,chain:n.chain,client:n.client}),_t(n.chain),we(n,s==null?void 0:s.address)]),y=c,p=await ee(n.value)||0n;return{token:{address:q,name:o.nativeCurrency.name,symbol:o.nativeCurrency.symbol,icon:(g=o.icon)==null?void 0:g.url},decimals:18,walletBalance:y,gasCostWei:l,transactionValueWei:p}},enabled:!!n&&!!s&&!!a,refetchInterval:()=>{if(!n.erc20Value)return 3e4}})}async function we(e,n){try{const s=await Ln({transaction:e,from:n}),i=s.wei/10n;return s.wei+i}catch{return n?await we(e):2000000n*await st({client:e.client,chain:e.chain})}}function Yn(e){var x,w;const{payUiOptions:n,client:s,payerAccount:i,supportedDestinations:a,onContinue:u}=e,{data:r}=ct(n.transaction.chain),c=n.metadata,{data:o}=Kn({transaction:n.transaction,account:i,supportedDestinations:a}),l=Y(),y=Ce(),p=Ut(y);return!o||!r?t.jsx(Se,{}):t.jsxs(d,{p:"lg",children:[t.jsx(X,{title:(c==null?void 0:c.name)||"Transaction"}),t.jsx(h,{y:"lg"}),t.jsxs(d,{children:[c!=null&&c.image?t.jsx(Te,{client:s,src:c==null?void 0:c.image,style:{width:"100%",borderRadius:E.md,backgroundColor:l.colors.tertiaryBg}}):y?t.jsxs(d,{flex:"row",center:"both",style:{padding:E.md,marginBottom:E.md,borderRadius:E.md,backgroundColor:l.colors.tertiaryBg},children:[t.jsx(Ae,{size:b.xl,id:y.id,client:s}),t.jsx("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:l.colors.secondaryIconColor,marginLeft:E.md,marginRight:E.md}}),t.jsx(me,{client:s,size:b.xl,chainIconUrl:(x=r.icon)==null?void 0:x.url})]}):null,t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(m,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(pe,{chain:n.transaction.chain,client:e.client,size:"sm",token:o.token}),t.jsxs(m,{color:"primaryText",size:"md",weight:700,children:[String(K(Number(he(o.transactionValueWei,o.decimals)),6))," ",o.token.symbol]})]})})]}),t.jsx(h,{y:"md"}),t.jsx(ne,{}),t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(m,{size:"xs",color:"secondaryText",children:"Gas Fees"})}),t.jsx(d,{expand:!0,children:t.jsx(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(m,{color:p?"success":"primaryText",size:"xs",children:p?"Sponsored":`${String(K(Number(he(o.gasCostWei,r.nativeCurrency.decimals)),6))} ${r.nativeCurrency.symbol}`})})})]}),t.jsx(h,{y:"sm"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(m,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(me,{chainIconUrl:(w=r.icon)==null?void 0:w.url,size:"xs",client:e.client}),t.jsx(m,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:r.name})]})})]})]}),t.jsx(h,{y:"xl"}),i?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{let g=o.transactionValueWei;o.token.address===q&&!p&&(g+=o.gasCostWei),u(he(g,o.decimals),n.transaction.chain,o.token)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(ve,{...e.connectOptions,client:s,theme:l,connectButton:{style:{width:"100%"}}})})]})}function At(e){const n=Y();return t.jsx(d,{bg:"tertiaryBg",style:{borderRadius:$.lg,border:`1px solid ${n.colors.borderColor}`,...e.containerStyle},children:t.jsxs(P,{fullWidth:!0,disabled:e.disabled,onClick:e.onClick,variant:"ghost",style:{justifyContent:"space-between",padding:E.sm,backgroundColor:n.colors.tertiaryBg},gap:"sm",children:[t.jsx(ke,{client:e.client,address:e.address}),!e.disableChevron&&t.jsx(fe,{width:b.sm,height:b.sm,style:{color:n.colors.secondaryText}}),e.checked&&t.jsx(Ht,{width:b.md,height:b.md})]})})}function ke(e){const{client:n,address:s}=e,a=lt().find(l=>{var y;return((y=l.getAccount())==null?void 0:y.address)===e.address}),u=e.walletId||(a==null?void 0:a.id),r=rt({client:n,address:s}),c=r.data||be(s),o=Qt({client:n,ensName:r.data});return t.jsxs(d,{flex:"row",center:"y",gap:"sm",color:"secondaryText",children:[o.data?t.jsx(Te,{src:o.data,width:b.md,height:b.md,style:{borderRadius:$.sm},client:e.client}):u?t.jsx(Ae,{id:u,size:b.md,client:e.client}):null,t.jsx(m,{size:"sm",color:"primaryText",children:c||be(e.address)})]})}function Zn(e){return t.jsxs(d,{children:[t.jsx(d,{p:"lg",children:t.jsx(X,{title:"Pay with",onBack:e.onBack})}),t.jsx(ne,{}),t.jsx(h,{y:"lg"}),t.jsx(d,{flex:"column",gap:"xs",px:"lg",children:dt.map(n=>t.jsxs(Jn,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[t.jsx(n.icon,{size:b.lg}),t.jsxs(d,{flex:"column",gap:"xxs",children:[t.jsx(m,{color:"primaryText",children:n.shorthand}),t.jsx(m,{size:"sm",children:n.name})]})]},n.shorthand))}),t.jsx(h,{y:"lg"})]})}const Jn=Be(P)(()=>{const e=Y();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:E.sm,padding:E.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}});function pt(e,n){const a=(window.innerHeight-750)/2,u=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=500, height=750, top=${a}, left=${u}`)}function Xn(e){var o,l,y,p;const n=$t(),{openedWindow:s,onSuccess:i}=e,a=Gt({intentId:e.intentId,client:e.client});let u="loading";((o=a.data)==null?void 0:o.status)==="ON_RAMP_TRANSFER_FAILED"||((l=a.data)==null?void 0:l.status)==="PAYMENT_FAILED"?u="failed":((y=a.data)==null?void 0:y.status)==="CRYPTO_SWAP_FALLBACK"?u="partialSuccess":((p=a.data)==null?void 0:p.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(u="completed");const r=j.useRef(!1);j.useEffect(()=>{var x;r.current||!i||((x=a.data)==null?void 0:x.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(r.current=!0,i(a.data))},[i,a.data]),j.useEffect(()=>{var x,w;!s||!a.data||(((x=a.data)==null?void 0:x.status)==="CRYPTO_SWAP_REQUIRED"||((w=a.data)==null?void 0:w.status)==="ON_RAMP_TRANSFER_COMPLETED")&&s.close()},[a.data,s]);const c=j.useRef(!1);return j.useEffect(()=>{var x;!c.current&&((x=a.data)==null?void 0:x.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(c.current=!0,Vt(n))},[a.data,n]),j.useEffect(()=>{var x;((x=a.data)==null?void 0:x.status)==="CRYPTO_SWAP_REQUIRED"&&e.onShowSwapFlow(a.data)},[a.data,e.onShowSwapFlow]),t.jsxs(d,{p:"lg",children:[t.jsx(X,{title:e.title,onBack:e.onBack}),e.hasTwoSteps&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"lg"}),t.jsx(ut,{steps:2,currentStep:1}),t.jsx(h,{y:"sm"}),t.jsxs(m,{size:"xs",children:["Step 1 of 2 - Buying ",e.quote.onRampToken.token.symbol," with"," ",e.quote.fromCurrencyWithFees.currencySymbol]})]}),t.jsx(es,{uiStatus:u,onDone:e.onDone,fiatStatus:a.data,client:e.client,transactionMode:e.transactionMode,quote:e.quote,isEmbed:e.isEmbed})]})}function es(e){const{uiStatus:n}=e,s=e.fiatStatus?Kt(e.fiatStatus):void 0,i=e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"?e.fiatStatus:void 0,a=e.quote.onRampToken,u=t.jsx(Yt,{client:e.client,token:i!=null&&i.source?{chainId:i.source.token.chainId,address:i.source.token.tokenAddress,symbol:i.source.token.symbol||"",amount:i.source.amount}:{chainId:a.token.chainId,address:a.token.tokenAddress,symbol:a.token.symbol,amount:a.amount},fiat:{amount:e.quote.fromCurrencyWithFees.amount,currencySymbol:e.quote.fromCurrencyWithFees.currencySymbol},statusMeta:i!=null&&i.source&&s?{color:s==null?void 0:s.color,text:s==null?void 0:s.status,txHash:i.source.transactionHash}:void 0});return t.jsxs(d,{children:[t.jsx(h,{y:"xl"}),n==="loading"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"md"}),t.jsx(d,{flex:"row",center:"x",children:t.jsx(je,{size:"xxl",color:"accentText"})}),t.jsx(h,{y:"md"}),t.jsx(m,{color:"primaryText",size:"lg",center:!0,children:"Buy Pending"}),t.jsx(h,{y:"sm"}),!Zt()&&t.jsx(m,{center:!0,children:"Complete the purchase in popup"}),t.jsx(h,{y:"xxl"}),u]}),n==="failed"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"md"}),t.jsx(d,{flex:"row",center:"x",children:t.jsx(Jt,{size:b["3xl"]})}),t.jsx(h,{y:"lg"}),t.jsx(m,{color:"primaryText",size:"lg",center:!0,children:"Transaction Failed"}),t.jsx(h,{y:"xxl"}),u]}),n==="completed"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"md"}),t.jsx(d,{flex:"row",center:"x",color:"success",children:t.jsx(ht,{width:b["3xl"],height:b["3xl"]})}),t.jsx(h,{y:"md"}),t.jsx(m,{color:"primaryText",size:"lg",center:!0,children:"Buy Complete"}),e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"xxl"}),u,t.jsx(h,{y:"sm"})]}),!e.isEmbed&&t.jsx(P,{variant:"accent",fullWidth:!0,onClick:e.onDone,children:e.transactionMode?"Continue Transaction":"Done"})]})]})}function ts(e){const n=wt(e.quote),[s,i]=j.useState(n?{id:"step-1"}:{id:"onramp-status"}),[a,u]=j.useState(e.openedWindow),r=j.useCallback(()=>{Xt({intentId:e.quote.intentId,client:e.client}).then(c=>{e.onSuccess(c)})},[e.onSuccess,e.quote.intentId,e.client]);return s.id==="step-1"?t.jsx(en,{title:e.title,client:e.client,onBack:e.onBack,partialQuote:Ve(e.quote),step:1,onContinue:()=>{const c=pt(e.quote.onRampLink,e.theme);mt({type:"fiat",intentId:e.quote.intentId}),u(c),i({id:"onramp-status"})}}):s.id==="onramp-status"?t.jsx(Xn,{title:e.title,client:e.client,intentId:e.quote.intentId,onBack:e.onBack,hasTwoSteps:n,openedWindow:a,quote:e.quote,onDone:e.onDone,onShowSwapFlow:c=>{i({id:"postonramp-swap",data:c})},transactionMode:e.transactionMode,isEmbed:e.isEmbed,onSuccess:e.onSuccess}):s.id==="postonramp-swap"?t.jsx(tn,{title:e.title,status:s.data,quote:Ve(e.quote),client:e.client,onBack:e.onBack,onDone:e.onDone,onSwapFlowStarted:()=>{},transactionMode:e.transactionMode,isEmbed:e.isEmbed,payer:e.payer,onSuccess:r}):null}function ns(e){const{payOptions:n,supportedDestinations:s,toChain:i,toToken:a}=e;function u(){const p=s.find(g=>g.chain.id===i.id);if(!p)return{fiat:!1,swap:!1};const x=N(a)?q:a.address,w=p.tokens.find(g=>g.address.toLowerCase()===x.toLowerCase());return w?{fiat:w.buyWithFiatEnabled,swap:w.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:r,swap:c}=u(),o=n.buyWithFiat!==!1&&r,l=n.buyWithCrypto!==!1&&c;return{buyWithFiatEnabled:o,buyWithCryptoEnabled:l,showPaymentSelection:o&&l}}const et=J({id:137,name:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function ss(e){var W,D,B,L,S,I,U,_,O,H,M;const n=xt(),{payOptions:s,supportedDestinations:i}=e,a=s==null?void 0:s.prefillBuy,u=(a==null?void 0:a.amount)||"",[r,c]=j.useState(u),o=nn(r,300),[l,y]=j.useState((a==null?void 0:a.chain)||s.mode==="transaction"&&((W=s.transaction)==null?void 0:W.chain)||s.mode==="direct_payment"&&((D=s.paymentInfo)==null?void 0:D.chain)||((B=i.find(Q=>Q.chain.id===(n==null?void 0:n.id)))==null?void 0:B.chain)||et),[p,x]=j.useState((a==null?void 0:a.token)||s.mode==="direct_payment"&&s.paymentInfo.token||Ke),[w,g]=j.useState(s.buyWithCrypto!==!1&&((S=(L=s.buyWithCrypto)==null?void 0:L.prefillSource)==null?void 0:S.chain)||s.mode==="transaction"&&((I=s.transaction)==null?void 0:I.chain)||s.mode==="direct_payment"&&((U=s.paymentInfo)==null?void 0:U.chain)||et),[C,F]=j.useState(s.buyWithCrypto!==!1&&((O=(_=s.buyWithCrypto)==null?void 0:_.prefillSource)==null?void 0:O.token)||s.mode==="direct_payment"&&s.paymentInfo.token||Ke),f=(s.buyWithFiat!==!1?(M=(H=s.buyWithFiat)==null?void 0:H.prefillSource)==null?void 0:M.currency:void 0)||as(),[R,z]=j.useState(dt.find(Q=>Q.shorthand===f)||sn);return{tokenAmount:r,setTokenAmount:c,toChain:l,setToChain:y,deferredTokenAmount:o,fromChain:w,setFromChain:g,toToken:p,setToToken:x,fromToken:C,setFromToken:F,selectedCurrency:R,setSelectedCurrency:z}}function as(){try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone.toLowerCase();return e.includes("london")?"GBP":e.includes("europe")?"EUR":e.includes("japan")?"JPY":e.includes("canada")?"CAD":"USD"}catch{return"USD"}}function is(e){return e.length>10?"26px":e.length>6?"34px":"50px"}function os(e){const{name:n}=yt(e.chain),s=()=>{let i=e.value.replace(".","").length;return e.value.includes(".")&&(i+=.3),`calc(${`${Math.max(1,i)}ch`} + 6px)`};return t.jsxs(d,{children:[t.jsx("div",{onClick:i=>{var a;(a=i.currentTarget.querySelector("input"))==null||a.focus()},children:t.jsxs(d,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t.jsx(an,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:i=>{e.value===""&&i.currentTarget.setSelectionRange(i.currentTarget.value.length,i.currentTarget.value.length)},onChange:i=>{let a=i.target.value;a.startsWith(".")&&(a=`0${a}`);const u=Number(a);Number.isNaN(u)||(a.startsWith("0")&&!a.startsWith("0.")?e.onChange(a.slice(1)):e.onChange(a))},style:{border:"none",fontSize:is(e.value),boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:s(),maxWidth:"calc(100% - 100px)"}}),t.jsx(se,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),!e.hideTokenSelector&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"sm"}),t.jsx(d,{flex:"row",center:"x",children:t.jsxs(cs,{variant:"secondary",fullWidth:!0,style:{fontSize:V.sm},gap:"xxs",onClick:e.onSelectToken,disabled:e.freezeChainAndToken,children:[t.jsxs(d,{flex:"row",center:"y",gap:"sm",children:[t.jsx(pe,{token:e.token,chain:e.chain,size:"md",client:e.client}),t.jsxs(d,{flex:"column",style:{gap:"4px"},children:[t.jsx(se,{token:e.token,chain:e.chain,size:"sm"}),n?t.jsx(m,{size:"xs",color:"secondaryText",children:n}):t.jsx(te,{width:"90px",height:V.xs})]})]}),t.jsx(fe,{width:b.sm,height:b.sm,style:{marginLeft:"auto"}})]})})]})]})}const cs=Be(P)(()=>{const e=Y();return{background:e.colors.tertiaryBg,border:`1px solid ${e.colors.borderColor}`,justifyContent:"flex-start",transition:"background 0.3s",padding:E.sm}}),rs=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",width:e.size,height:e.size,role:"presentation",children:t.jsx("path",{fill:"currentColor",d:"M15.6 4.6H1.85v-.55l12.1-.968v.968h1.65V2.4c0-1.21-.98-2.059-2.177-1.888L2.378 2.089C1.18 2.26.2 3.39.2 4.6v11a2.2 2.2 0 002.2 2.2h13.2a2.2 2.2 0 002.2-2.2V6.8a2.2 2.2 0 00-2.2-2.2zm-1.65 7.707a1.65 1.65 0 01-.63-3.176 1.65 1.65 0 11.63 3.176z"})});function ls(e){const{name:n}=yt(e.chain),s=ft({address:e.payerAccount.address,chain:e.chain,tokenAddress:N(e.token)?void 0:e.token.address,client:e.client});return t.jsxs(d,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderWidth:"1px",borderTopWidth:0,borderStyle:"solid",flexWrap:"nowrap",justifyContent:"space-between",minHeight:"64px",alignItems:"center",...e.swapRequired?{borderBottom:"none"}:{borderBottomLeftRadius:$.md,borderBottomRightRadius:$.md}},children:[t.jsxs(P,{variant:"ghost",onClick:e.onSelectToken,gap:"sm",style:{paddingInline:E.sm,paddingBlock:E.sm,minWidth:"50%",justifyContent:"flex-start"},disabled:e.freezeChainAndTokenSelection,children:[t.jsx(jt,{token:e.token,chain:e.chain,size:"md",client:e.client}),t.jsxs(d,{flex:"column",gap:"3xs",children:[t.jsxs(d,{flex:"row",gap:"xs",center:"y",color:"primaryText",children:[t.jsx(se,{token:e.token,chain:e.chain,size:"sm"}),t.jsx(fe,{width:b.sm,height:b.sm})]}),n?t.jsx(m,{size:"xs",children:n}):t.jsx(te,{width:"90px",height:V.xs})]})]}),t.jsxs("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:E.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:E.sm},children:[e.isLoading?t.jsx(te,{width:"120px",height:V.md,color:"borderColor"}):t.jsx(m,{size:"md",color:e.value?"primaryText":"secondaryText",style:{},children:K(Number(e.value),6)||""}),t.jsxs(d,{flex:"row",gap:"xxs",center:"y",color:"secondaryText",children:[t.jsx(rs,{size:V.xs}),s.data?t.jsx(m,{size:"xs",color:"secondaryText",weight:500,children:on(s.data,!1)}):t.jsx(te,{width:"70px",height:V.xs})]})]})]})}async function ds(e){try{const s=await it(e.client)(cn(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({fromAddress:e.fromAddress,toAddress:e.toAddress,chainId:e.chainId,tokenAddress:e.tokenAddress,amount:e.amount,purchaseData:e.purchaseData})});if(!s.ok){const u=await s.json();throw u&&"error"in u?u:new Error(`HTTP error! status: ${s.status}`)}const i=(await s.json()).result;return{transactionRequest:{chain:Ye(i.transactionRequest.chainId),client:e.client,data:i.transactionRequest.data,to:i.transactionRequest.to,value:BigInt(i.transactionRequest.value),gas:BigInt(i.transactionRequest.gasLimit)},approval:i.approval?rn({contract:ye({client:e.client,address:i.approval.tokenAddress,chain:Ye(i.approval.chainId)}),spender:i.approval.spenderAddress,amountWei:BigInt(i.approval.amountWei)}):void 0,fromAddress:i.fromAddress,toAddress:i.toAddress,paymentToken:i.paymentToken,processingFee:i.processingFee,estimatedGasCostUSDCents:i.estimatedGasCostUSDCents,client:e.client}}catch(n){throw console.error("Error getting buy with crypto transfer",n),n}}function us(e){const{title:n,onBack:s,receiverAddress:i,client:a,payer:u,onDone:r,chain:c,token:o,tokenAmount:l,transactionMode:y,setTransactionHash:p}=e,[x,w]=j.useState("transfer"),[g,C]=j.useState("idle"),{symbol:F}=ln(c);return t.jsxs(d,{p:"lg",children:[t.jsx(X,{title:n,onBack:s}),t.jsx(h,{y:"xl"}),y&&t.jsxs(t.Fragment,{children:[t.jsx(ut,{steps:2,currentStep:x==="transfer"?1:2}),t.jsx(h,{y:"sm"}),t.jsx(m,{size:"sm",children:x==="transfer"?"Step 1 of 2 - Transfer funds":"Step 2 of 2 - Finalize transaction"}),t.jsx(h,{y:"xl"})]}),t.jsxs(d,{flex:"row",center:"y",style:{justifyContent:"space-between"},children:[t.jsx(m,{size:"sm",children:"From"}),t.jsx(ke,{address:u.account.address,client:a})]}),t.jsx(h,{y:"md"}),t.jsx(ne,{}),t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",center:"y",style:{justifyContent:"space-between"},children:[t.jsx(m,{size:"sm",children:"To"}),t.jsx(ke,{address:i,client:a})]}),t.jsx(h,{y:"md"}),t.jsx(ne,{}),t.jsx(h,{y:"md"}),t.jsx(dn,{chainId:c.id,client:a,label:"Amount",tokenAmount:l,tokenSymbol:N(o)?F||"":o.symbol,tokenAddress:N(o)?q:o.address}),t.jsx(h,{y:"lg"}),y&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"sm"}),t.jsxs(d,{gap:"sm",flex:"row",style:{justifyContent:"space-between"},center:"y",color:"accentText",children:[t.jsx(Ze,{isDone:x==="execute",isActive:x==="transfer",label:x==="transfer"?"Transfer":"Done"}),t.jsx(un,{}),t.jsx(Ze,{isDone:!1,label:"Finalize",isActive:x==="execute"})]}),t.jsx(h,{y:"lg"})]}),g==="error"&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{flex:"row",gap:"xs",center:"both",color:"danger",children:[t.jsx(hn,{width:b.sm,height:b.sm}),t.jsx(m,{color:"danger",size:"sm",children:x==="transfer"?"Failed to Transfer":"Failed to Execute"})]}),t.jsx(h,{y:"md"})]}),!y&&x==="execute"&&g==="done"&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{flex:"row",gap:"xs",center:"both",color:"success",children:[t.jsx(ht,{width:b.sm,height:b.sm}),t.jsx(m,{color:"success",size:"sm",children:"Payment completed"})]}),t.jsx(h,{y:"md"})]}),u.chain.id!==c.id?t.jsx(gt,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(c)}}):t.jsxs(P,{variant:"accent",fullWidth:!0,disabled:g==="pending",onClick:async()=>{if(x==="execute"){r();return}try{if(C("pending"),y){const T=N(o)?mn({client:a,chain:c,to:i,value:xn(l)}):yn({contract:ye({address:o.address,chain:c,client:a}),to:i,amount:l});await Xe({account:e.payer.account,transaction:T}),w("execute"),C("idle")}else{const T=await ds({client:a,fromAddress:u.account.address,toAddress:i,chainId:c.id,tokenAddress:N(o)?q:o.address,amount:l,purchaseData:void 0});console.log("transferResponse",T),T.approval&&(w("approve"),await Xe({account:e.payer.account,transaction:T.approval})),w("transfer");const f=T.transactionRequest,R=await at({account:e.payer.account,transaction:f});p(R.transactionHash),C("idle")}}catch(T){console.error(T),C("error")}},gap:"xs",children:[x==="execute"&&(g==="done"?"Done":"Continue"),x==="transfer"&&(g==="pending"?"Confirming":"Confirm"),x==="approve"&&(g==="pending"?"Approving":"Approve"),g==="pending"&&t.jsx(je,{size:"sm",color:"accentButtonText"})]})]})}function hs(e){const[n,s]=j.useState();return n?t.jsx(fn,{title:e.title,onBack:e.onBack,onTryAgain:e.onTryAgain,swapTxHash:n,client:e.client,onDone:e.onDone,transactionMode:!1,isEmbed:e.isEmbed,quote:void 0,onSuccess:e.onSuccess}):t.jsx(us,{...e,setTransactionHash:s})}function ms(e){var a;const n=Y(),s=lt(),i=!e.showAllWallets&&((a=e.wallets)==null?void 0:a.every(u=>s.includes(u)));return t.jsxs(d,{children:[t.jsxs(d,{flex:"column",gap:"xs",children:[s.map(u=>{var c;const r=(c=u.getAccount())==null?void 0:c.address;return t.jsx(At,{walletId:u.id,client:e.client,address:r||"",onClick:()=>{e.onSelect(u),e.onBack()},disableChevron:!0,checked:!1},u.id)}),!i&&t.jsx(P,{variant:"secondary",fullWidth:!0,onClick:e.onConnect,gap:"xs",bg:"tertiaryBg",style:{borderRadius:$.lg,border:`1px solid ${n.colors.borderColor}`,padding:E.sm},children:t.jsxs(d,{flex:"row",gap:"sm",center:"y",expand:!0,children:[t.jsx(jn,{width:b.md,height:b.md}),t.jsx(m,{size:"sm",color:"primaryText",children:"Add Another Wallet"})]})})]}),t.jsx(h,{y:"sm"})]})}function xs(){const e=Ce(),n=bt(),s=xt(),[i,a]=j.useState();return j.useEffect(()=>{const c=i==null?void 0:i.wallet;function o(){if(!c){a(void 0);return}const l=c.getAccount(),y=c.getChain();l&&y?(console.log("updated to",l,y),a({account:l,chain:y,wallet:c})):a(void 0)}if(c){const l=c.subscribe("chainChanged",o),y=c.subscribe("accountChanged",o);return()=>{l(),y()}}},[i]),{payer:i||(n&&s&&e?{account:n,chain:s,wallet:e}:void 0),setPayer:a}}function ps(e){const n=gn(e.client);return n.data?t.jsx(ys,{...e,supportedDestinations:n.data}):t.jsx(Se,{})}function ys(e){var le,ae,ie,oe,ce,re,G,de,ge,ue,Ee,We,Ie,Fe,ze,Re,De,Oe,Pe,Me,Le,Ne,qe,_e,Ue,He,Qe;const{client:n,supportedDestinations:s,connectLocale:i,payOptions:a}=e,u=bt(),{payer:r,setPayer:c}=xs(),[o,l]=j.useState({id:"main"}),[y,p]=j.useState(!1),x=j.useCallback(()=>{l({id:"main"}),e.onDone()},[e.onDone]),{tokenAmount:w,setTokenAmount:g,toChain:C,setToChain:F,deferredTokenAmount:T,fromChain:f,setFromChain:R,toToken:z,setToToken:W,fromToken:D,setFromToken:B,selectedCurrency:L,setSelectedCurrency:S}=ss({payOptions:a,supportedDestinations:s}),I=bn({client:e.client,destinationChainId:C.id,destinationTokenAddress:N(z)?q:z.address}),U=j.useMemo(()=>tt(s,a,e.supportedTokens),[e.supportedTokens,s,a]),_=j.useMemo(()=>{var v,k;if(!I.data)return;const A=I.data;return(v=A[0])!=null&&v.chain&&R((k=A[0])==null?void 0:k.chain),tt(A,a,e.supportedTokens)},[e.supportedTokens,I.data,a,R]),O=ns({payOptions:e.payOptions,supportedDestinations:e.supportedDestinations,toChain:C,toToken:z}),H=O.showPaymentSelection===!1&&O.buyWithCryptoEnabled===!1&&O.buyWithFiatEnabled===!1,M=j.useCallback(A=>{var v,k;(k=(v=e.payOptions).onPurchaseSuccess)==null||k.call(v,{type:"crypto",status:A})},[e.payOptions.onPurchaseSuccess]),Q=j.useCallback(A=>{var v,k;(k=(v=e.payOptions).onPurchaseSuccess)==null||k.call(v,{type:"fiat",status:A})},[e.payOptions.onPurchaseSuccess]);if(o.id==="connect-payer-wallet")return t.jsx(wn,{accountAbstraction:(le=e.connectOptions)==null?void 0:le.accountAbstraction,appMetadata:(ae=e.connectOptions)==null?void 0:ae.appMetadata,chain:(ie=e.connectOptions)==null?void 0:ie.chain,chains:(oe=e.connectOptions)==null?void 0:oe.chains,client:e.client,connectLocale:e.connectLocale,isEmbed:e.isEmbed,onBack:()=>l(o.backScreen),onSelect:A=>{const v=A.getAccount(),k=A.getChain();A&&v&&k&&c({account:v,chain:k,wallet:A})},recommendedWallets:(ce=e.connectOptions)==null?void 0:ce.recommendedWallets,showAllWallets:((re=e.connectOptions)==null?void 0:re.showAllWallets)===void 0?!0:(G=e.connectOptions)==null?void 0:G.showAllWallets,walletConnect:(de=e.connectOptions)==null?void 0:de.walletConnect,wallets:(ge=e.connectOptions)==null?void 0:ge.wallets});if(o.id==="swap-flow"&&r)return t.jsx(kn,{title:e.title,transactionMode:a.mode==="transaction",isEmbed:e.isEmbed,client:n,onBack:()=>{l({id:"buy-with-crypto"})},buyWithCryptoQuote:o.quote,payer:r,isFiatFlow:!1,onDone:x,onTryAgain:()=>{l({id:"buy-with-crypto"})},onSuccess:M});if(o.id==="fiat-flow"&&r)return t.jsx(ts,{title:e.title,transactionMode:a.mode==="transaction",quote:o.quote,onBack:()=>{l({id:"buy-with-fiat"})},client:n,testMode:e.payOptions.buyWithFiat!==!1&&((ue=e.payOptions.buyWithFiat)==null?void 0:ue.testMode)===!0,theme:typeof e.theme=="string"?e.theme:e.theme.type,openedWindow:o.openedWindow,onDone:x,isEmbed:e.isEmbed,payer:r,onSuccess:Q});if(o.id==="transfer-flow"&&r&&u){const A=()=>l({id:"buy-with-crypto"}),k=((We=(Ee=e.payOptions)==null?void 0:Ee.paymentInfo)==null?void 0:We.sellerAddress)||u.address;return t.jsx(hs,{title:e.title,onBack:A,payer:r,client:e.client,chain:C,token:z,tokenAmount:w,receiverAddress:k,transactionMode:e.payOptions.mode==="transaction",isEmbed:e.isEmbed,onDone:x,onTryAgain:()=>{l({id:"buy-with-crypto"})},onSuccess:M})}if(o.id==="select-currency"){const A=()=>l(o.backScreen);return t.jsx(Zn,{onSelect:v=>{A(),S(v)},onBack:A})}if(o.id==="select-to-token"){const A=s.map(Z=>Z.chain),v=()=>l(o.backScreen),k=(Ie=a==null?void 0:a.prefillBuy)==null?void 0:Ie.allowEdits;return(k==null?void 0:k.token)===!1?t.jsx(nt,{chains:A,client:e.client,connectLocale:e.connectLocale,setChain:F,goBack:v}):t.jsx(Je,{onBack:v,tokenList:((C!=null&&C.id?U[C.id]:void 0)||[]).filter(Z=>Z.address!==q),onTokenSelect:Z=>{W(Z),v()},chain:C,chainSelection:(k==null?void 0:k.chain)!==!1?{chains:A,select:Z=>{F(Z)}}:void 0,connectLocale:i,client:n,modalTitle:e.title})}if(o.id==="select-from-token"&&I.data&&_){const A=I.data.map(k=>k.chain),v=()=>l(o.backScreen);return a.buyWithCrypto!==!1&&((Re=(ze=(Fe=a.buyWithCrypto)==null?void 0:Fe.prefillSource)==null?void 0:ze.allowEdits)==null?void 0:Re.token)===!1?t.jsx(nt,{chains:A,client:e.client,connectLocale:e.connectLocale,setChain:R,goBack:v}):t.jsx(Je,{onBack:v,tokenList:((f!=null&&f.id?_[f.id]:void 0)||[]).filter(k=>k.address!==q),onTokenSelect:k=>{B(k),v()},chain:f,chainSelection:a.buyWithCrypto!==!1&&((Pe=(Oe=(De=a.buyWithCrypto)==null?void 0:De.prefillSource)==null?void 0:Oe.allowEdits)==null?void 0:Pe.chain)!==!1?{chains:I.data.map(k=>k.chain),select:k=>R(k)}:void 0,connectLocale:i,client:n,modalTitle:"Pay with"})}return t.jsx(d,{animate:"fadein",children:t.jsxs("div",{children:[o.id==="main"&&t.jsx(js,{title:e.title,payerAccount:r==null?void 0:r.account,client:n,onSelectBuyToken:()=>l({id:"select-to-token",backScreen:o}),payOptions:a,setTokenAmount:g,setToChain:F,setToToken:W,setFromChain:R,setFromToken:B,toChain:C,toToken:z,tokenAmount:w,connectOptions:e.connectOptions,setScreen:l,supportedDestinations:s,onBack:e.onBack,theme:e.theme,hasEditedAmount:y,setHasEditedAmount:p,enabledPaymentMethods:O}),(o.id==="select-payment-method"||o.id==="select-wallet"||o.id==="buy-with-crypto"||o.id==="buy-with-fiat")&&r&&t.jsxs(gs,{title:e.title,selectedChain:C,selectedToken:z,tokenAmount:w,client:n,onBack:()=>{O.showPaymentSelection&&(o.id==="select-wallet"||o.id==="buy-with-fiat")?l({id:"select-payment-method"}):o.id==="buy-with-crypto"?l({id:"select-wallet"}):l({id:"main"})},children:[o.id==="select-payment-method"&&t.jsx(bs,{setScreen:A=>l({id:A})}),o.id==="select-wallet"&&t.jsx(ms,{client:n,onSelect:A=>{const v=A.getChain(),k=A.getAccount();v&&k&&(c({account:k,chain:v,wallet:A}),l({id:"buy-with-crypto"}))},showAllWallets:!!((Me=e.connectOptions)!=null&&Me.showAllWallets),wallets:(Le=e.connectOptions)==null?void 0:Le.wallets,onBack:()=>{},onConnect:()=>{l({id:"connect-payer-wallet",backScreen:{id:"select-wallet"}})},selectedAddress:r.account.address}),o.id==="buy-with-crypto"&&u&&t.jsx(ws,{setScreen:l,tokenAmount:T,toChain:C,toToken:z,fromChain:f,fromToken:D,showFromTokenSelector:()=>{l({id:"select-from-token",backScreen:o})},payer:r,client:n,isEmbed:e.isEmbed,onDone:x,payOptions:a,connectLocale:i,connectOptions:e.connectOptions,setPayer:c,activeAccount:u,setTokenAmount:g,setHasEditedAmount:p,disableTokenSelection:H===!0||a.buyWithCrypto!==!1&&((_e=(qe=(Ne=a.buyWithCrypto)==null?void 0:Ne.prefillSource)==null?void 0:qe.allowEdits)==null?void 0:_e.chain)===!1&&((Qe=(He=(Ue=a.buyWithCrypto)==null?void 0:Ue.prefillSource)==null?void 0:He.allowEdits)==null?void 0:Qe.token)===!1}),o.id==="buy-with-fiat"&&t.jsx(ks,{setScreen:l,tokenAmount:T,toChain:C,toToken:z,selectedCurrency:L,client:n,isEmbed:e.isEmbed,onDone:x,payOptions:a,theme:e.theme,showCurrencySelector:()=>{l({id:"select-currency",backScreen:o})},payer:r,setTokenAmount:g,setHasEditedAmount:p})]})]})})}function fs(e){return t.jsx("div",{children:t.jsxs(d,{flex:"row",gap:"sm",center:"y",style:{justifyContent:"space-between"},children:[t.jsxs(d,{flex:"row",gap:"xs",center:"y",children:[t.jsx(m,{color:"primaryText","data-testid":"tokenAmount",size:"xl",children:K(Number(e.tokenAmount),6)}),t.jsxs(d,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(se,{token:e.selectedToken,chain:e.selectedChain,size:"md",color:"secondaryText"}),t.jsx(jt,{chain:e.selectedChain,client:e.client,size:"sm",token:e.selectedToken})]})]}),t.jsx(Bn,{chain:e.selectedChain,client:e.client,size:"sm",short:!0})]})})}function js(e){var f,R,z,W,D,B;const{setTokenAmount:n,setToChain:s,setToToken:i,setFromChain:a,setFromToken:u,payerAccount:r,client:c,tokenAmount:o,payOptions:l,toToken:y,toChain:p,supportedDestinations:x,enabledPaymentMethods:w}=e,{showPaymentSelection:g,buyWithCryptoEnabled:C,buyWithFiatEnabled:F}=w,T=!o;switch(l.mode){case"transaction":return t.jsx(Yn,{supportedDestinations:x,payUiOptions:l,payerAccount:r,connectOptions:e.connectOptions,client:c,onContinue:(L,S,I)=>{n(L),s(S),a(S),u(I),i(I),g?e.setScreen({id:"select-payment-method"}):C?e.setScreen({id:"select-wallet"}):F?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-wallet"})}});case"direct_payment":return t.jsx(Qn,{client:c,payUiOptions:l,payerAccount:r,connectOptions:e.connectOptions,supportedDestinations:x,onContinue:(L,S,I)=>{n(L),s(S),a(S),u(I),i(I),g?e.setScreen({id:"select-payment-method"}):C?e.setScreen({id:"buy-with-crypto"}):F?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-wallet"})}});default:return t.jsxs(d,{p:"lg",children:[t.jsx(X,{title:e.title,onBack:e.onBack}),t.jsx(h,{y:"xl"}),t.jsx(os,{value:o,onChange:async L=>{e.setHasEditedAmount(!0),n(L)},freezeAmount:((R=(f=l.prefillBuy)==null?void 0:f.allowEdits)==null?void 0:R.amount)===!1,freezeChainAndToken:((W=(z=l.prefillBuy)==null?void 0:z.allowEdits)==null?void 0:W.chain)===!1&&((B=(D=l.prefillBuy)==null?void 0:D.allowEdits)==null?void 0:B.token)===!1,token:y,chain:p,onSelectToken:e.onSelectBuyToken,client:e.client}),t.jsx(h,{y:"xl"}),t.jsx(d,{flex:"column",gap:"sm",children:r?t.jsx(P,{variant:"accent",fullWidth:!0,disabled:T,"data-disabled":T,onClick:()=>{g?e.setScreen({id:"select-payment-method"}):C?e.setScreen({id:"buy-with-crypto"}):F?e.setScreen({id:"buy-with-fiat"}):console.error("No payment method enabled")},children:"Continue"}):t.jsx("div",{children:t.jsx(ve,{...e.connectOptions,client:e.client,theme:e.theme,connectButton:{style:{width:"100%"}}})})})]})}}function gs(e){return t.jsxs(d,{children:[t.jsx(d,{p:"lg",children:t.jsx(X,{title:e.title,onBack:e.onBack})}),t.jsxs(d,{px:"lg",style:{paddingBottom:E.lg},children:[t.jsx(h,{y:"xs"}),t.jsx(fs,{selectedToken:e.selectedToken,selectedChain:e.selectedChain,tokenAmount:e.tokenAmount,client:e.client}),t.jsx(h,{y:"md"}),t.jsx(ne,{}),t.jsx(h,{y:"lg"}),t.jsx(m,{size:"sm",children:" Pay with "}),t.jsx(h,{y:"sm"}),e.children]})]})}function bs(e){return t.jsx(d,{animate:"fadein",children:t.jsxs(d,{flex:"column",gap:"sm",children:[t.jsxs(P,{variant:"outline",bg:"tertiaryBg",onClick:()=>e.setScreen("buy-with-fiat"),gap:"sm",style:{justifyContent:"flex-start",textAlign:"left"},children:[t.jsx(d,{color:"secondaryText",flex:"row",center:"both",children:t.jsx(Cn,{style:{width:b.md,height:b.md}})}),t.jsxs(d,{flex:"column",gap:"xxs",children:[t.jsx(m,{size:"md",color:"primaryText",children:"Credit Card"}),t.jsx(m,{size:"xs",children:"Securely pay with credit card"})]})]}),t.jsxs(P,{variant:"outline",bg:"tertiaryBg",onClick:()=>e.setScreen("select-wallet"),style:{justifyContent:"flex-start"},gap:"sm",children:[t.jsx(d,{color:"secondaryText",flex:"row",center:"both",children:t.jsx(Sn,{size:b.md})}),t.jsxs(d,{flex:"column",gap:"xxs",children:[t.jsx(m,{size:"md",color:"primaryText",children:"Crypto"}),t.jsx(m,{size:"xs",children:"Pay with your connected wallet"})]})]})]})})}function ws(e){var ae,ie,oe,ce,re;const{setScreen:n,payer:s,client:i,toChain:a,tokenAmount:u,toToken:r,fromChain:c,fromToken:o,showFromTokenSelector:l,payOptions:y,disableTokenSelection:p}=e,w=((ie=(ae=e.payOptions)==null?void 0:ae.paymentInfo)==null?void 0:ie.sellerAddress)||e.activeAccount.address,{drawerRef:g,drawerOverlayRef:C,isOpen:F,setIsOpen:T}=St(),[f,R]=j.useState("fees"),z=ft({address:s.account.address,chain:c,tokenAddress:N(o)?void 0:o.address,client:i}),W=N(o)?q:o.address.toLowerCase(),D=N(r)?q:r.address.toLowerCase(),B=!!u&&!(c.id===a.id&&W===D),L=B?{fromAddress:s.account.address,toAddress:w,fromChainId:c.id,fromTokenAddress:N(o)?q:o.address,toChainId:a.id,toTokenAddress:N(r)?q:r.address,toAmount:u,client:i,purchaseData:y.purchaseData}:void 0,S=Nn(L,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),I=B?(oe=S.data)==null?void 0:oe.swapDetails.fromAmount:u,U=!!I&&!!z.data&&Number(z.data.displayValue)<Number(I),_=B&&!S.data||U,O=e.payer.chain.id!==c.id;function H(G){const de="Unable to get price quote";try{if(G.error.code==="MINIMUM_PURCHASE_AMOUNT"){const ue=G.error.data.minimumAmountEth;return{minAmount:K(Number(ue),6)}}}catch{}return{msg:[de]}}const M=!S.isLoading&&S.error?H(S.error):void 0;function Q(){if((e.payOptions.mode==="transaction"||e.payOptions.mode==="direct_payment")&&!U&&!B){s.account.address!==w?n({id:"transfer-flow"}):e.onDone();return}S.data&&n({id:"swap-flow",quote:S.data})}function le(){S.data&&(T(!0),R("fees"))}return t.jsxs(d,{flex:"column",gap:"md",animate:"fadein",children:[F&&t.jsxs(t.Fragment,{children:[t.jsx(Ct,{ref:C}),t.jsx(kt,{ref:g,close:()=>T(!1),children:f==="fees"&&S.data&&t.jsxs("div",{children:[t.jsx(m,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(h,{y:"lg"}),t.jsx(Tn,{quote:S.data,align:"left"})]})})]}),t.jsxs("div",{children:[t.jsx(At,{client:e.client,onClick:()=>{n({id:"select-wallet"})},address:e.payer.account.address,walletId:e.payer.wallet.id,containerStyle:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}),t.jsx(ls,{value:I||"",onSelectToken:l,chain:c,token:o,isLoading:S.isLoading&&!I,client:i,freezeChainAndTokenSelection:p,payerAccount:e.payer.account,swapRequired:B}),B&&t.jsx(Tt,{quoteIsLoading:S.isLoading,estimatedSeconds:(ce=S.data)==null?void 0:ce.swapDetails.estimated.durationSeconds,onViewFees:le}),t.jsx(h,{y:"md"})]}),M&&t.jsxs("div",{children:[M.minAmount&&t.jsxs(m,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is ",M.minAmount," ",t.jsx(se,{token:r,chain:a,size:"sm",inline:!0,color:"danger"})]}),(re=M.msg)==null?void 0:re.map(G=>t.jsx(m,{color:"danger",size:"sm",center:!0,multiline:!0,children:G},G))]}),!M&&U&&t.jsxs("div",{children:[t.jsx(m,{color:"danger",size:"sm",center:!0,multiline:!0,children:"Not enough funds."}),t.jsx(m,{color:"danger",size:"sm",center:!0,multiline:!0,children:"Try a different wallet or token."})]}),M!=null&&M.minAmount?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{e.setTokenAmount(String(M.minAmount)),e.setHasEditedAmount(!0)},children:"Set Minimum"}):O&&!S.isLoading&&!U&&!S.error?t.jsx(gt,{variant:"accent",fullWidth:!0,switchChain:async()=>{await e.payer.wallet.switchChain(c)}}):t.jsx(P,{variant:_?"outline":"accent",fullWidth:!0,"data-disabled":_,disabled:_,onClick:async()=>{_||Q()},gap:"xs",children:S.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(je,{size:"sm",color:"accentText"})]}):"Continue"})]})}function ks(e){var L,S,I,U,_;const{toToken:n,tokenAmount:s,payer:i,client:a,setScreen:u,toChain:r,showCurrencySelector:c,selectedCurrency:o}=e,y=((S=(L=e.payOptions)==null?void 0:L.paymentInfo)==null?void 0:S.sellerAddress)||e.payer.account.address,{drawerRef:p,drawerOverlayRef:x,isOpen:w,setIsOpen:g}=St(),[C,F]=j.useState("fees"),T=e.payOptions.buyWithFiat,f=_n(T!==!1&&s?{fromCurrencySymbol:o.shorthand,toChainId:r.id,toAddress:y,toTokenAddress:N(n)?q:n.address,toAmount:s,client:a,isTestMode:T==null?void 0:T.testMode,purchaseData:e.payOptions.purchaseData,fromAddress:i.account.address}:void 0);function R(){if(!f.data)return;const O=wt(f.data);let H=null;O||(H=pt(f.data.onRampLink,typeof e.theme=="string"?e.theme:e.theme.type),mt({type:"fiat",intentId:f.data.intentId})),u({id:"fiat-flow",quote:f.data,openedWindow:H})}function z(){f.data&&(F("fees"),g(!0))}function W(O){const H="Unable to get price quote";try{if(O.error.code==="MINIMUM_PURCHASE_AMOUNT"){const Q=O.error.data.minimumAmountEth;return{minAmount:K(Number(Q),6)}}}catch{}return{msg:[H]}}const D=!f.data,B=!f.isLoading&&f.error?W(f.error):void 0;return t.jsxs(d,{flex:"column",gap:"md",animate:"fadein",children:[w&&t.jsxs(t.Fragment,{children:[t.jsx(Ct,{ref:x}),t.jsx(kt,{ref:p,close:()=>g(!1),children:C==="fees"&&f.data&&t.jsxs("div",{children:[t.jsx(m,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(h,{y:"lg"}),t.jsx(An,{quote:f.data})]})})]}),t.jsxs("div",{children:[t.jsx(Gn,{isLoading:f.isLoading,value:(I=f.data)==null?void 0:I.fromCurrencyWithFees.amount,client:a,currency:o,onSelectCurrency:c}),t.jsx(Tt,{quoteIsLoading:f.isLoading,estimatedSeconds:(U=f.data)==null?void 0:U.estimatedDurationSeconds,onViewFees:z}),t.jsx(h,{y:"md"})]}),B&&t.jsxs("div",{children:[B.minAmount&&t.jsxs(m,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is ",B.minAmount," ",t.jsx(se,{token:n,chain:r,size:"sm",inline:!0,color:"danger"})]}),(_=B.msg)==null?void 0:_.map(O=>t.jsx(m,{color:"danger",size:"sm",center:!0,multiline:!0,children:O},O))]}),B!=null&&B.minAmount?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{e.setTokenAmount(String(B.minAmount)),e.setHasEditedAmount(!0)},children:"Set Minimum"}):t.jsx(P,{variant:D?"outline":"accent","data-disabled":D,disabled:D,fullWidth:!0,onClick:R,gap:"xs",children:f.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(je,{size:"sm",color:"accentText"})]}):"Continue"})]})}function tt(e,n,s){const i={},a=n.buyWithFiat===!1,u=n.buyWithCrypto===!1;for(const r of e)i[r.chain.id]=r.tokens.filter(c=>c.buyWithCryptoEnabled&&c.buyWithFiatEnabled?!0:!(!c.buyWithCryptoEnabled&&a||!c.buyWithFiatEnabled&&u));if(s)for(const r in s){const c=Number(r),o=s[c];o&&(i[c]=o)}return i}function nt(e){return t.jsx(pn,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.goBack,chains:e.chains,closeModal:e.goBack,networkSelector:{renderChain(n){return t.jsx(vn,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.goBack()},client:e.client,connectLocale:e.connectLocale})}}})}export{ps as default};
